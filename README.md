# DAQ-Middleware Sockライブラリサンプル

DAQ-MiddlewareにはソケットライブラリとしてC++のソケットライブラリSockが
付属しています。

このリポジトリは今後の改良のためのものです。

現状のSockライブラリのコードをclient/Sock.{h,cpp}としておいてあります。
サーバー用にCで書いたものをserverディレクトリ以下においてあります。

## 検討事項

よく使うreadAll()は中でrecv(sockfd, buf, buflen, MSG_WAITALL)として
buflenバイト読んで返るようにしています。
DAQ-Middlewareではdaq_run()の仕様上の制限からソケットのように無限ブロックする
可能性があるものを使う場合にはタイムアウト付きで呼ぶことになっています（無限ブロック
するとdaq_stopなどの状態に遷移することができなくなるためこの制限が付いています）。
ソケットライブラリではデフォルトのタイムアウト値は2秒に設定されています。

タイムアウトするまでにbuflenバイトのデータが来なかった場合は
recv(MSG_WAITALL)は読める分だけ読んでリターンします。

現状のSockライブラリではこのような読まれ方は想定されていません（たしかに
readAll()という名前からは想定外というのがただしいかもしれません）。
